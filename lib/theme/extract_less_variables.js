var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=getLessVars;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _lodash=_interopRequireDefault(require("lodash"));var _fs=_interopRequireDefault(require("fs"));var _lessNode=_interopRequireDefault(require("less/lib/less-node"));var _path=_interopRequireDefault(require("path"));function getLessVars(from){var dirname=_path.default.dirname(from);var src=_fs.default.readFileSync(from);return _lessNode.default.parse(src.toString(),{paths:[dirname],javascriptEnabled:true}).then(function(parsed){return _lessNode.default.render("\n@import \""+from+"\";\n"+Object.keys(parsed.variables()).map(function(v){return"."+v.slice(1)+" { value: "+v+"; }";}).join("\n"),{paths:[dirname],javascriptEnabled:true,compress:true});}).then(function(_ref){var css=_ref.css;return css.split("}").map(function(line){var parts=line.match(/^\.([\w-]+)\s*\{\s*value:\s*([^;]+);?$/);if(!parts){return undefined;}return[parts[1],parts[2]];});}).then(function(pairs){return pairs.filter(function(p){return!_lodash.default.isNil(p);});}).then(function(pairs){return pairs.map(function(_ref2){var _ref3=(0,_slicedToArray2.default)(_ref2,2),k=_ref3[0],v=_ref3[1];return[k,!isNaN(v)&&_lodash.default.toNumber(v)||(v==="true"||v==="false")&&v==="true"||v];});}).then(function(pairs){return _lodash.default.sortBy(pairs,"0");}).then(_lodash.default.fromPairs);}